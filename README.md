/**
 * ============================================================================
 * VitePress Markmap æ’ä»¶ - é¡¹ç›®æ€»ä½“è¯´æ˜æ–‡æ¡£
 * ============================================================================
 *
 * æœ¬æ–‡æ¡£æä¾›äº†å®Œæ•´çš„é¡¹ç›®å·¥ç¨‹è¯´æ˜ï¼ŒåŒ…æ‹¬æ¶æ„ã€æ ¸å¿ƒæ¨¡å—ã€é›†æˆæ–¹å¼ç­‰ã€‚
 */

# VitePress Markmap æ’ä»¶ - å·¥ç¨‹æ€»è¯´æ˜

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

**é¡¹ç›®åç§°**ï¼šVitePress Markmap Plugin  
**ç‰ˆæœ¬**ï¼š1.0.0  
**ç±»å‹**ï¼šVite æ’ä»¶  
**ç”¨é€”**ï¼šåœ¨ VitePress ä¸­æ¸²æŸ“äº¤äº’å¼è„‘å›¾  
**ä¾èµ–**ï¼šmarkmap-libï¼Œmarkmap-viewï¼Œvue@3  
**è®¸å¯è¯**ï¼šMIT

### æ ¸å¿ƒä»·å€¼ä¸»å¼ 

- **ä¸€é”®é›†æˆ**ï¼šç”¨æˆ·åªéœ€è¦åœ¨ VitePress é…ç½®ä¸­å¼•å…¥æ’ä»¶ï¼Œæ— éœ€é¢å¤–é…ç½®
- **é›¶å­¦ä¹ æˆæœ¬**ï¼šä½¿ç”¨æ ‡å‡†çš„ Markdown å®¹å™¨è¯­æ³• `:::markmap`
- **å¼€ç®±å³ç”¨**ï¼šæ’ä»¶è‡ªåŠ¨å¤„ç† Markdown è§£æã€ç»„ä»¶æ³¨å…¥ã€æ ·å¼åŠ è½½ç­‰æ‰€æœ‰å·¥ä½œ
- **å®Œå…¨è‡ªåŠ¨åŒ–**ï¼šæ— éœ€æ‰‹åŠ¨å¯¼å…¥ç»„ä»¶ã€åº“æˆ–æ ·å¼æ–‡ä»¶

## ğŸ—ï¸ é¡¹ç›®æ¶æ„

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               VitePress App                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â”‚ Vite build
                     â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                               â”‚
â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Markdown file    â”‚        â”‚  VitePress      â”‚
â”‚                   â”‚        â”‚  plugins        â”‚
â”‚ :::markmap        â”‚        â”‚                 â”‚
â”‚ # Root            â”‚        â”‚ vitepress-      â”‚
â”‚ ## Child 1        â”‚        â”‚ plugin-markmap  â”‚
â”‚ ## Child 2        â”‚        â”‚                 â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                            â”‚
     â”‚   Vite transform           â”‚
     â”‚   hooks                    â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ Markdown parse          â”‚
          â”‚ (utils.ts)              â”‚
          â”‚                         â”‚
          â”‚ 1. Extraction container â”‚
          â”‚ 2. Parsing attributes   â”‚
          â”‚ 3. Verification content â”‚
          â”‚ 4. Standardized format  â”‚
          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
          â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ Transform Vue Component â”‚
          â”‚                         â”‚
          â”‚ <Markmap                â”‚
          â”‚   content="..."         â”‚
          â”‚   width="100%"          â”‚
          â”‚   height="500px"        â”‚
          â”‚ />                      â”‚
          â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
          â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ Markmap component       â”‚
          â”‚  (markmap.vue)          â”‚
          â”‚                         â”‚
          â”‚  1. Markdown content    â”‚
          â”‚  2. markmap-lib         â”‚
          â”‚     Transform markmap   â”‚
          â”‚     data structure      â”‚
          â”‚  3. markmap-view        â”‚
          â”‚     Render view         â”‚
          â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
          â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ Output HTML             â”‚
          â”‚                         â”‚
          â”‚ <svg>markmap</svg>      â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```


## ğŸ”§ æ ¸å¿ƒæ¨¡å—è¯¦è§£

### [1] æ’ä»¶ä¸»æ–‡ä»¶ (src/index.ts)

**èŒè´£**ï¼šå®ç° Vite æ’ä»¶æ¥å£ï¼Œå¤„ç† Markdown æ–‡ä»¶è½¬æ¢

```typescript
export default function markmapPlugin(options) {
  return {
    name: '@vitepress-plugin/markmap',
    enforce: 'pre',
    apply: 'both',
    
    // 1. resolveId é’©å­ï¼šå¤„ç†è™šæ‹Ÿæ¨¡å—å¯¼å…¥
    //    å¤„ç† '@vitepress-plugin/markmap:markmap' è™šæ‹Ÿæ¨¡å—
    
    // 2. load é’©å­ï¼šè¿”å›è™šæ‹Ÿæ¨¡å—å†…å®¹
    //    åŠ¨æ€åŠ è½½ Markmap ç»„ä»¶
    
    // 3. transform é’©å­ï¼šæ ¸å¿ƒè½¬æ¢é€»è¾‘
    //    - æ£€æŸ¥æ–‡ä»¶æ˜¯å¦ä¸º .md æ–‡ä»¶
    //    - ä½¿ç”¨ utils.ts ä¸­çš„ transformMarkmapContainers å‡½æ•°
    //    - è½¬æ¢ :::markmap å®¹å™¨ä¸º <Markmap /> ç»„ä»¶è°ƒç”¨
    //    - è‡ªåŠ¨æ³¨å…¥ Markmap ç»„ä»¶çš„å¯¼å…¥è¯­å¥
    
    // 4. handleHotUpdate é’©å­ï¼šå¤„ç† HMR çƒ­æ›´æ–°
  }
}
```

**å…³é”®æµç¨‹**ï¼š
1. æ£€æŸ¥æ–‡ä»¶æ‰©å±•åï¼ˆ.md/.markdown/.mdxï¼‰
2. ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…è„‘å›¾å®¹å™¨
3. è§£æå®¹å™¨å±æ€§ï¼ˆwidth, height, zoom, pan, themeï¼‰
4. è½¬æ¢ä¸º Vue ç»„ä»¶è°ƒç”¨
5. æ³¨å…¥ç»„ä»¶å¯¼å…¥è¯­å¥

### [2] Vue 3 è„‘å›¾ç»„ä»¶ (src/markmap.vue)

**èŒè´£**ï¼šæ¸²æŸ“äº¤äº’å¼è„‘å›¾ï¼Œé›†æˆ markmap åº“

```typescript
export default defineComponent({
  name: 'Markmap',
  props: {
    content,      // Markdown æ ¼å¼çš„è„‘å›¾å†…å®¹ï¼ˆå¿…éœ€ï¼‰
    width,        // å®¹å™¨å®½åº¦ï¼ˆé»˜è®¤ 100%ï¼‰
    height,       // å®¹å™¨é«˜åº¦ï¼ˆé»˜è®¤è‡ªåŠ¨è®¡ç®—ï¼‰
  },
  
  setup(props) {
    const svgRef = ref()     // SVG å…ƒç´ å¼•ç”¨
    
    const renderMarkmap = async () => {
      // 1. éªŒè¯å†…å®¹ä¸ä¸ºç©º
      // 2. ä½¿ç”¨ Transformer å°† Markdown è½¬æ¢ä¸ºè„‘å›¾ç»“æ„
      // 3. åˆ›å»ºæˆ–æ›´æ–° Markmap å®ä¾‹
    }
    
    // å“åº”å¼æ›´æ–°å†…å®¹
    watchEffect(() => {
      if (props.content) renderMarkmap()
    })
  },
  
  render() {
    // è¿”å› SVG å®¹å™¨å…ƒç´ 
  }
})
```

**é›†æˆçš„åº“**ï¼š
- `markmap-lib`ï¼šMarkdown â†’ è„‘å›¾ç»“æ„çš„è½¬æ¢å¼•æ“
- `markmap-view`ï¼šè„‘å›¾çš„äº¤äº’å¼æ¸²æŸ“å’Œæ§åˆ¶

### [3] ç±»å‹å®šä¹‰ (src/types.ts)

**èŒè´£**ï¼šæä¾›å®Œæ•´çš„ TypeScript ç±»å‹æ”¯æŒ


## ğŸ”„ æ‰§è¡Œæµç¨‹è¯¦è§£

### 1. ç”¨æˆ·åœ¨ Markdown ä¸­ç¼–å†™è„‘å›¾

```markdown
# æˆ‘çš„è„‘å›¾

:::markmap
* Root Node
  - Branch 1
    + Leaf 1.1
  - Branch 2
:::
```

### 2. VitePress è¯»å–æ–‡ä»¶å¹¶è§¦å‘ Vite æ„å»º

```
File: docs/example.md
Content: (ä¸Šè¿° Markdown)
```

### 3. Vite è°ƒç”¨æ’ä»¶çš„ transform é’©å­

```javascript
// index.ts ä¸­çš„ transform é’©å­è¢«è§¦å‘
transform(src: string, id: string) {
  // id = '/path/to/example.md'
  // src = å®Œæ•´çš„ Markdown å†…å®¹
}
```

### 4. æ’ä»¶æ‰§è¡Œè½¬æ¢é€»è¾‘

```javascript
// æ­¥éª¤ 1ï¼šæ£€æŸ¥æ–‡ä»¶ç±»å‹
if (!['.md', '.markdown', '.mdx'].includes(ext)) return null

// æ­¥éª¤ 2ï¼šè°ƒç”¨ transformMarkmapContainers
transformed = transformMarkmapContainers(src)
```

### 5. æ³¨å…¥ç»„ä»¶å¯¼å…¥è¯­å¥

```md
<script>
import markmap from '@vitepress-plugin/markmap/markmap';
import '@vitepress-plugin/markmap/style.css';
</script>
```

### 6. è¿”å›è½¬æ¢ç»“æœ

```javascript
return {
  code: transformed,    // è½¬æ¢åçš„ä»£ç 
  map: null            // Source map
}
```

### 7. VitePress ç¼–è¯‘å¹¶ç”Ÿæˆ HTML

```html
<div class="markmap-container">
  <svg class="markmap">
    <!-- è„‘å›¾ SVG å†…å®¹ -->
  </svg>
</div>
```

### 8. æµè§ˆå™¨åŠ è½½å¹¶äº¤äº’

- markmap ç»„ä»¶åœ¨æµè§ˆå™¨ä¸­å®ä¾‹åŒ–
- markmap-view æ¸²æŸ“äº¤äº’å¼è„‘å›¾

## ğŸ“¦ æ„å»ºè¿‡ç¨‹

### ç”Ÿäº§æ„å»º

```bash
pnpm build
# æ­¥éª¤ 1ï¼šæ‰§è¡Œ vite build
#   - ç¼–è¯‘ src/index.ts ä¸º dist/index.es.js
#   - ç¼–è¯‘ src/markmap.vue ä¸º dist/markmap.es.js å’Œ dist/style.css

# æ­¥éª¤ 2ï¼šæ‰§è¡Œ tsc --emitDeclarationOnly
#   - ç”Ÿæˆ .d.ts ç±»å‹å®šä¹‰æ–‡ä»¶
```

### æ„å»ºäº§ç‰©

```
dist/
â”œâ”€â”€ index.es.js          # æ’ä»¶ ES æ¨¡å—ç‰ˆæœ¬
â”œâ”€â”€ markmap.es.js        # ç»„ä»¶ ES æ¨¡å—ç‰ˆæœ¬
â”œâ”€â”€ style.css            # ç»„ä»¶æ ·å¼
â”œâ”€â”€ index.d.ts           # æ’ä»¶ç±»å‹å®šä¹‰
â””â”€â”€ type.d.ts            # ç±»å‹å®šä¹‰
```

## ğŸ”Œ ä¸ VitePress çš„é›†æˆ

### é›†æˆç‚¹ 1ï¼šé…ç½®é˜¶æ®µ

```typescript
// .vitepress/config.mts
import markmapPlugin from '@vitepress-plugin/markmap'

export default defineConfig({
  vite: {
    plugins: [
      markmapPlugin({ /* é…ç½® */ })
    ]
  }
})
```

### é›†æˆç‚¹ 2ï¼šæ„å»ºé˜¶æ®µ

- æ’ä»¶çš„ `transform` é’©å­åœ¨ Vite æ„å»ºæ—¶è¢«è°ƒç”¨
- è½¬æ¢ Markdown æ–‡ä»¶ä¸­çš„è„‘å›¾å®¹å™¨
- æ³¨å…¥ç»„ä»¶å¯¼å…¥

### é›†æˆç‚¹ 3ï¼šè¿è¡Œæ—¶

- Markmap ç»„ä»¶åœ¨ Vue 3 ä¸­æ¸²æŸ“
- markmap-lib å¤„ç† Markdown è§£æ
- markmap-view æä¾›äº¤äº’èƒ½åŠ›


## ğŸ“š ç›¸å…³æ–‡æ¡£

- [Markmap å®˜æ–¹æ–‡æ¡£](https://markmap.js.org/)
- [Vite æ’ä»¶å¼€å‘](https://vitejs.dev/guide/api-plugin.html)
- [Vue 3 å®˜æ–¹æ–‡æ¡£](https://vuejs.org/)
- [VitePress æ–‡æ¡£](https://vitepress.dev/)

---

**è®¸å¯è¯**ï¼šMIT
